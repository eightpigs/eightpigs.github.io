

<meta charset="utf-8" />
<meta name="generator" content="Hugo 0.68.1" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Eightpigs, eightpigs@outlook.com" />
<meta property="og:url" content="https://eightpigs.io/2015/07/23/windows_vpn_tools_by_csharp/" />
<link rel="canonical" href="https://eightpigs.io/2015/07/23/windows_vpn_tools_by_csharp/" />

<link rel="stylesheet" href="/css/github-markdown.css?t=1464395400000">

<link rel="stylesheet" href="/css/head.css?t=1464395400000">
<link rel="stylesheet" href="/css/style.css?t=1464395400000">
<link rel="stylesheet" href="/css/list.css?t=1464395400000">

<title>C#写的windows下快捷管理VPN工具 - Eightpigs</title>
<meta property="og:title" content="C#写的windows下快捷管理VPN工具 - Eightpigs" />
<meta property="og:type" content="article" />
<meta property="og:description" content="简介 使用C#写的windows 下快捷管理VPN工具，可以实现对本地VPN的增加,修改,删除管理 原理 windows有自带的连接管理工具 rasphone ,可以" />
<meta name="description" content="简介 使用C#写的windows 下快捷管理VPN工具，可以实现对本地VPN的增加,修改,删除管理 原理 windows有自带的连接管理工具 rasphone ,可以" />
<meta name="keywords" content="IT,Java,Go,Web,Programmer,Algorithm" />

<link rel="stylesheet" href="/css/highlight/gruvbox-light.css">

<link rel="stylesheet" href="/css/post.css?t=1464395400000">




<div class="content markdown-body">
  <h1>C#写的windows下快捷管理VPN工具 </h1>
  <div class="info">
    <span class="date">
      2015-07-23
    </span>

    
      
      <span class="categories">
      
      <a data-real="Creation" href="/categories/creation/" class="category">
        作品
      </a>
      ‣
      </span>
    
    
    <span class="tags">
      
      <a data-real=".Net" href="/tags/.net/" class="tag">#.Net</a>
      
      <a data-real="VPN" href="/tags/vpn/" class="tag">#VPN</a>
      
      <a data-real="Tools" href="/tags/tools/" class="tag">#Tools</a>
      
    </span>
  </div>
  </h1>

  

  <h2 id="简介">简介</h2>
<p>使用C#写的windows 下快捷管理VPN工具，可以实现对本地VPN的增加,修改,删除管理</p>
<h2 id="原理">原理</h2>
<ul>
<li>windows有自带的连接管理工具 rasphone ,可以实现对链接进行新建/修改/连接/删除/断开等操作</li>
</ul>
<p>在cmd输入 : <strong>rasphone /?</strong> 就可以查看所有命令操作信息</p>
<ul>
<li>查看现在是否有VPN连接可以使用 <strong>rasdial</strong> 命令.</li>
</ul>
<h2 id="使用">使用</h2>
<ul>
<li>由于对C#不是很熟悉,新增vpn时需要给名称前面添加 vpn 作为前缀 &hellip;</li>
<li>鼠标悬停在每一个功能按钮都有相应提示.操作非常简单.</li>
<li>鼠标移开窗体会自动隐藏,在屏幕的右上方显示当前状态线.(已连接:绿色   未连接:红色)</li>
<li>工具条固定在屏幕有上方.X轴大约在屏幕3/4的地方.</li>
<li>提供一个VPN列表和用户信息列表(VPN的帐号),VPN列表是通过获取系统的adsl连接</li>
<li>用户列表可以多个,具体在程序启动目录的app.config里面配置user节点.</li>
</ul>
<hr>
<h3 id="处理vpn的代码">处理VPN的代码</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">using</span> System;
<span style="color:#66d9ef">using</span> System.Collections.Generic;
<span style="color:#66d9ef">using</span> System.Linq;
<span style="color:#66d9ef">using</span> System.Text;

<span style="color:#66d9ef">namespace</span> ConciseVPN
{
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * VPN操作类
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">VPNTools</span>
    {

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 连接指定名称的VPN
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">bool</span> connect(<span style="color:#66d9ef">string</span> vpnName, <span style="color:#66d9ef">string</span> username, <span style="color:#66d9ef">string</span> password)
        {
            String command = <span style="color:#e6db74">&#34;rasdial &#34;</span> + vpnName + <span style="color:#e6db74">&#34; &#34;</span> + username + <span style="color:#e6db74">&#34; &#34;</span> + password;
            String result = Command.execute(command);
            <span style="color:#66d9ef">if</span> (result.IndexOf(<span style="color:#e6db74">&#34;已连接&#34;</span>) &gt; <span style="color:#ae81ff">0</span>)
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
        }

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 断开指定VPN连接
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">bool</span> disConnect(String vpnName)
        {
            String command = <span style="color:#e6db74">&#34;rasdial &#34;</span> + vpnName + <span style="color:#e6db74">&#34; /disconnect&#34;</span>;
            String result = Command.execute(command);
            <span style="color:#66d9ef">if</span> (result.IndexOf(<span style="color:#e6db74">&#34;没有连接&#34;</span>) &gt; <span style="color:#ae81ff">0</span>)
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
        }

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 新建VPN连接
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> createConnection() {
            String command = <span style="color:#e6db74">&#34;rasphone -a&#34;</span> ;
            Command.execute(command);
        }

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 删除VPN连接
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> deleteConnection(String vpnName)
        {
            String command = <span style="color:#e6db74">&#34;rasphone -r &#34;</span> + vpnName;
            Command.execute(command);
        }

        <span style="color:#75715e">/**
</span><span style="color:#75715e">        * 修改VPN连接
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> editConnection(String vpnName)
        {
            String command = <span style="color:#e6db74">&#34;rasphone -e &#34;</span> + vpnName;
            Command.execute(command);
        }

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 检测是否有VPN连接
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String checkCoonnect()
        {
            String result = Command.execute(<span style="color:#e6db74">&#34;rasdial&#34;</span>);
            <span style="color:#66d9ef">if</span> (result.IndexOf(<span style="color:#e6db74">&#34;没有连接&#34;</span>) != -<span style="color:#ae81ff">1</span>)
                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;false&#34;</span>;
            <span style="color:#66d9ef">else</span>{<span style="color:#75715e">//返回连接中的VPN名称
</span><span style="color:#75715e"></span>                result = result.Replace(<span style="color:#e6db74">&#34;已连接&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>).Replace(<span style="color:#e6db74">&#34;命令已完成。&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>);
                result = result.Substring(result.IndexOf(<span style="color:#e6db74">&#34;vpn_&#34;</span>));
                result = result.Substring(<span style="color:#ae81ff">0</span>, result.IndexOf(<span style="color:#e6db74">&#34;\n\n\r\n&#34;</span>));
                <span style="color:#66d9ef">return</span> result;
            }
        }
    }
}
</code></pre></div><h2 id="截图">截图</h2>
<p>VPN连接成功,在屏幕右上方显示的绿色状态条(不要说你看不到&hellip;.)</p>
<p><img src="http://7j1zb7.com1.z0.glb.clouddn.com/csharevpnScreenshot_1.png" alt="连接成功"></p>
<p>鼠标放到状态条显示的软件主界面
<img src="http://7j1zb7.com1.z0.glb.clouddn.com/csharevpnScreenshot_2.png" alt="主界面"></p>
<p>VPN和用户列表
<img src="http://7j1zb7.com1.z0.glb.clouddn.com/csharevpnScreenshot_3.png" alt="主界面的VPN/用户列表"></p>
<p>VPN未连接状态
<img src="http://7j1zb7.com1.z0.glb.clouddn.com/csharevpnScreenshot_4.png" alt="未连接"></p>
<h2 id="下载">下载</h2>
<ul>
<li>源码 : <a href="https://github.com/joylyl/ConciseVPN">https://github.com/joylyl/ConciseVPN</a></li>
<li>程序 : <a href="http://pan.baidu.com/s/1dDpUHg9">http://pan.baidu.com/s/1dDpUHg9</a> 密码：3s54</li>
<li>源码+程序 : <a href="http://pan.baidu.com/s/1qWHsEHA">http://pan.baidu.com/s/1qWHsEHA</a> 密码：bj9n</li>
</ul>


  
    <br />
    <br />
    <hr />
    文章作者：eightpigs
    <br />
    创作时间：2015-07-23
    <br />
    更新时间：
    
      2019-03-04
    
    <br />
    许可协议：<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" class="cc">CC by-nc-nd 4.0</a>
    <hr />
  
</div>

<script charset="utf-8">
  encode("tag")
  encode("category")
  function encode(ele) {
    var elems = document.getElementsByClassName(ele)
    if (elems) {
      for (var i=0; i < elems.length; i++) {
        var id = elems[i].getAttribute("data-real")
        var href = elems[i].getAttribute("href")
        if (href && id) {
          id = id.toLowerCase()
          if (href.indexOf(id) != -1) {
            elems[i].setAttribute("href",  href.replace(id, encodeURIComponent(id)));
          }
        }
      }
    }
  }
</script>



<div class="footer">
  
  <div class="copyright">&copy; 2014 - 
    
      2020

    
      Eightpigs 
  </div>
  
  <div class="navbar">
  <ul>
  
    <li>
      <a href="/">首页</a>
    </li>
  
    <li>
      <a href="/archives">归档</a>
    </li>
  
    <li>
      <a href="/pages/about">关于</a>
    </li>
  
  </ul>
</div>

</div>


<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
 


  


  


  


