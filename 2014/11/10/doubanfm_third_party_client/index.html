

<meta charset="utf-8" />
<meta name="generator" content="Hugo 0.68.1" />

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Eightpigs, eightpigs@outlook.com" />
<meta property="og:url" content="https://eightpigs.io/2014/11/10/doubanfm_third_party_client/" />
<link rel="canonical" href="https://eightpigs.io/2014/11/10/doubanfm_third_party_client/" />

<link rel="stylesheet" href="/css/github-markdown.css?t=1464395400000">

<link rel="stylesheet" href="/css/head.css?t=1464395400000">
<link rel="stylesheet" href="/css/style.css?t=1464395400000">
<link rel="stylesheet" href="/css/list.css?t=1464395400000">

<title>豆瓣FM第三方客户端 - Eightpigs</title>
<meta property="og:title" content="豆瓣FM第三方客户端 - Eightpigs" />
<meta property="og:type" content="article" />
<meta property="og:description" content="更新说明
2018-03-15：该代码在14年下半年完成，所以略丑陋。已经转网易云音乐多年了，如果有人在使用本客户端或想使用，可以给我提issues，会花时间重构代码。" />
<meta name="description" content="更新说明
2018-03-15：该代码在14年下半年完成，所以略丑陋。已经转网易云音乐多年了，如果有人在使用本客户端或想使用，可以给我提issues，会花时间重构代码。" />
<meta name="keywords" content="IT,Java,Go,Web,Programmer,Algorithm" />

<link rel="stylesheet" href="/css/highlight/gruvbox-light.css">

<link rel="stylesheet" href="/css/post.css?t=1464395400000">




<div class="content markdown-body">
  <h1>豆瓣FM第三方客户端 </h1>
  <div class="info">
    <span class="date">
      2014-11-10
    </span>

    
      
      <span class="categories">
      
      <a data-real="Creation" href="/categories/creation/" class="category">
        作品
      </a>
      ‣
      </span>
    
    
    <span class="tags">
      
      <a data-real=".Net" href="/tags/.net/" class="tag">#.Net</a>
      
      <a data-real="Third-party" href="/tags/third-party/" class="tag">#Third-party</a>
      
    </span>
  </div>
  </h1>

  

  <h2 id="更新说明">更新说明</h2>
<p>2018-03-15：该代码在14年下半年完成，所以略丑陋。已经转网易云音乐多年了，如果有人在使用本客户端或想使用，可以给我提issues，会花时间重构代码。</p>
<h2 id="由来">由来</h2>
<ul>
<li>非常喜欢豆瓣FM</li>
<li>非常喜欢豆瓣FM</li>
<li>非常喜欢豆瓣FM</li>
<li>重要的事说三遍</li>
</ul>
<p>作为一个程序猿 , 想要什么还不是信手拈来? 于是乎 , 在没有用得习惯的豆瓣FM客户端的时候 ,我开始自己写客户端了. 这个客户端在去年就完成了 , 发表在以前博客的过 .</p>
<h2 id="简介">简介</h2>
<ul>
<li>使用C#完成的豆瓣FM第三方客户端</li>
<li>界面风格/操作与网页版基本相同</li>
<li>可以选择赫兹列表、登录用户并且对对歌曲红心/不再听/下载等操作</li>
</ul>
<h2 id="原理">原理</h2>
<p>由于豆瓣FM是不公开API的 , 但是不公开就没有吗? 网上大神通过抓包把基本功能API都获取到了.于是我就基于现成的API写的.如果感兴趣可以去看看我使用的接口 : <a href="https://github.com/zonyitoo/doubanfm-qt/wiki/%E8%B1%86%E7%93%A3FM-API">github</a></p>
<h2 id="使用">使用</h2>
<ul>
<li>软件首次启动会在系统中的最大磁盘新建一个名为 &ldquo;SimpleFM_Music&rdquo; 的文件夹存放下载的音乐</li>
<li>只有登录用户才可对歌曲进行红心/不再听操作</li>
<li>双击封面显示赫兹列表,单击赫兹名称选择赫兹并显示封面</li>
</ul>
<h2 id="快捷键">快捷键</h2>
<ul>
<li>Alt+Shift+C  关闭软件</li>
<li>Alt+Shift+S  显示/隐藏软件</li>
<li>Alt+Shift+N  切歌</li>
<li>Alt+Shift+U  不再听</li>
<li>Alt+Shift+L  添加或取消红心</li>
<li>Alt+Shift+H  显示行赫兹列表</li>
<li>Alt+Shift+P  播放/暂停</li>
<li>Alt+Shift+D  打开登录界面</li>
<li>Alt+Shift+D  打开登录界面</li>
<li>Alt+Shift+X  下载当前歌曲</li>
<li>Ctrl+Alt+Up  增大音量</li>
<li>Ctrl+Alt+Down  降低音量</li>
</ul>
<h2 id="截图">截图</h2>
<p>软件启动后的主界面</p>
<p><img src="simplefmScreenshot_1.png" alt="主界面"></p>
<hr>
<h4 id="登录界面">登录界面</h4>
<p><img src="simplefmScreenshot_2.png" alt="登录界面"></p>
<hr>
<h4 id="赫兹列表">赫兹列表</h4>
<p><img src="simplefmScreenshot_3.png" alt="赫兹列表"></p>
<hr>
<h4 id="播放音乐">播放音乐</h4>
<h2 id="播放音乐simplefmscreenshot_4png"><img src="simplefmScreenshot_4.png" alt="播放音乐"></h2>
<h4 id="加红心">加红心</h4>
<p><img src="simplefmScreenshot_5.png" alt="加红心"></p>
<hr>
<h4 id="音量控制">音量控制</h4>
<p><img src="simplefmScreenshot_6.png" alt="音量控制"></p>
<hr>
<h4 id="暂停播放">暂停播放</h4>
<p><img src="simplefmScreenshot_7.png" alt="暂停播放"></p>
<h2 id="代码">代码</h2>
<p>类比较多 , 就贴豆瓣FM处理的类</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">
<span style="color:#66d9ef">using</span> System;
<span style="color:#66d9ef">using</span> System.Net;
<span style="color:#66d9ef">using</span> System.IO;
<span style="color:#66d9ef">using</span> System.Text;

<span style="color:#66d9ef">namespace</span> DesireFM
{
    <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// FM歌曲相关操作类
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 获取歌曲
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 获取赫兹
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 暂停歌曲
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 下一首
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 红心/取消红心
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 不再听
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// 下载当前歌曲
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FMUtil</span>
    {

        <span style="color:#75715e">#region 需要重复使用的变量
</span><span style="color:#75715e"></span>         

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 需要用到的地址
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> url;
        
        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 请求响应对象
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> WebClient client;

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// JSON结果
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> jsonStr;

        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>

        <span style="color:#75715e">#region 用户登录
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 用户登录
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> Login()
        {
            <span style="color:#75715e">//登录地址
</span><span style="color:#75715e"></span>             url= String.Format(<span style="color:#e6db74">&#34;http://www.douban.com/j/app/login?app_name=radio_desktop_win&amp;version=100&amp;email={0}&amp;password={1}&#34;</span>,UserEntity.email,UserEntity.password);

            client = <span style="color:#66d9ef">new</span> WebClient();
            client.Credentials = CredentialCache.DefaultCredentials;
            <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>            client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
            client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
            jsonStr = client.DownloadString(url);
            <span style="color:#75715e">//返回的Cookie.用来获取红心列表
</span><span style="color:#75715e"></span>            Global.Cookie = client.ResponseHeaders.Get(<span style="color:#e6db74">&#34;Set-Cookie&#34;</span>);

            <span style="color:#66d9ef">return</span> jsonStr;
        }
        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>
            
        <span style="color:#75715e">#region 获取所有赫兹
</span><span style="color:#75715e"></span>        
        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 获取所有赫兹
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> getChances()
        {
            url = <span style="color:#e6db74">&#34;http://www.douban.com/j/app/radio/channels&#34;</span>;
            client=<span style="color:#66d9ef">new</span> WebClient();
            client.Credentials = CredentialCache.DefaultCredentials;
            <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>            client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
            client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
            jsonStr = client.DownloadString(url);
            <span style="color:#66d9ef">return</span> jsonStr;
        }
        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>

        <span style="color:#75715e">#region 歌曲操作
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 歌曲操作
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;channel_id&#34;&gt;&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String getSongs(<span style="color:#66d9ef">int</span> channel_id,<span style="color:#66d9ef">string</span> type,<span style="color:#66d9ef">string</span> sid)
        {
            <span style="color:#75715e">//获取新歌曲
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (type.Equals(<span style="color:#e6db74">&#34;n&#34;</span>))
            {
                
                <span style="color:#66d9ef">if</span>(UserEntity.userName!=<span style="color:#66d9ef">null</span>)
                    url = <span style="color:#66d9ef">string</span>.Format(<span style="color:#e6db74">&#34;http://www.douban.com/j/app/radio/people?type=n&amp;app_name=radio_desktop_win&amp;version=100&amp;channel={0}&amp;user_id={1}&amp;expire={2}&amp;token={3}&#34;</span>, channel_id, UserEntity.userId, UserEntity.expire, UserEntity.token);
                <span style="color:#66d9ef">else</span>
                    url = <span style="color:#66d9ef">string</span>.Format(<span style="color:#e6db74">&#34;http://www.douban.com/j/app/radio/people?app_name=radio_desktop_win&amp;version=100&amp;type=n&amp;channel={0}&#34;</span>, channel_id);

                client = <span style="color:#66d9ef">new</span> WebClient();
                client.Credentials = CredentialCache.DefaultCredentials;
                <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>                client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
                client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
                jsonStr = client.DownloadString(url);
            }
                <span style="color:#75715e">//不再听
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (type.Equals(<span style="color:#e6db74">&#34;b&#34;</span>))
            {
                url = <span style="color:#66d9ef">string</span>.Format(<span style="color:#e6db74">&#34;http://www.douban.com/j/app/radio/people?app_name=radio_desktop_win&amp;version=100&amp;sid={0}&amp;type=b&amp;user_id={1}&amp;expire={2}&amp;token={3}&amp;channel={4}&#34;</span>, sid, UserEntity.userId, UserEntity.expire, UserEntity.token, channel_id);
                client = <span style="color:#66d9ef">new</span> WebClient();
                client.Credentials = CredentialCache.DefaultCredentials;
                <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>                client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
                client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
                jsonStr = client.DownloadString(url);
            }
                <span style="color:#75715e">//加红心
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (type.Equals(<span style="color:#e6db74">&#34;r&#34;</span>))
            {
                url = <span style="color:#66d9ef">string</span>.Format(<span style="color:#e6db74">&#34;http://www.douban.com/j/app/radio/people?app_name=radio_desktop_win&amp;version=100&amp;sid={0}&amp;type=r&amp;user_id={1}&amp;expire={2}&amp;token={3}&amp;channel={4}&#34;</span>, sid, UserEntity.userId, UserEntity.expire, UserEntity.token,channel_id);
                client = <span style="color:#66d9ef">new</span> WebClient();
                client.Credentials = CredentialCache.DefaultCredentials;
                <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>                client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
                client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
                jsonStr = client.DownloadString(url);
            }
                <span style="color:#75715e">//取消红心
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(type.Equals(<span style="color:#e6db74">&#34;u&#34;</span>))
            {
                url = <span style="color:#66d9ef">string</span>.Format(<span style="color:#e6db74">&#34;http://www.douban.com/j/app/radio/people?app_name=radio_desktop_win&amp;version=100&amp;sid={0}&amp;type=u&amp;user_id={1}&amp;expire={2}&amp;token={3}&amp;channel={4}&#34;</span>, sid, UserEntity.userId, UserEntity.expire, UserEntity.token, channel_id);
                client = <span style="color:#66d9ef">new</span> WebClient();
                client.Credentials = CredentialCache.DefaultCredentials;
                <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>                client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
                client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
                jsonStr = client.DownloadString(url);
            }

            <span style="color:#66d9ef">return</span> jsonStr;
        }
        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>

        <span style="color:#75715e">#region 下载单首
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 下载单首流并播放
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;songUrl&#34;&gt;&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> downOneSongStream()
        {
            client = <span style="color:#66d9ef">new</span> WebClient(); 
            client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
            client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
            client.DownloadFile(Global.Songs[frmMain.SongListIndex].url, Global.downLoadPath+<span style="color:#e6db74">&#34;/&#34;</span> + Global.Songs[frmMain.SongListIndex].title+<span style="color:#e6db74">&#34;.mp3&#34;</span>);
        }
        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>

        <span style="color:#75715e">#region 得到流
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// 得到流
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;streamUrl&#34;&gt;&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Stream downStream(<span style="color:#66d9ef">string</span> streamUrl)
        {
            client = <span style="color:#66d9ef">new</span> WebClient();
            client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
            client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
            <span style="color:#66d9ef">return</span> client.OpenRead(streamUrl);
        }
        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">#region 获取红心列表
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> GetRedHreats()
        {
            <span style="color:#75715e">//登录地址
</span><span style="color:#75715e"></span>            url = String.Format(<span style="color:#e6db74">&#34;http://douban.fm/mine#!type=liked&amp;start=1&#34;</span>);

            client = <span style="color:#66d9ef">new</span> WebClient();
            client.Credentials = CredentialCache.DefaultCredentials;
            <span style="color:#75715e">//模拟IE的方式访问
</span><span style="color:#75715e"></span>            client.Headers.Add(<span style="color:#e6db74">&#34;User-Agent&#34;</span>, <span style="color:#e6db74">&#34;Microsoft Internet Explorer&#34;</span>);
            client.Headers.Add(<span style="color:#e6db74">&#34;Cookie&#34;</span>,Global.Cookie);
            client.Encoding = <span style="color:#66d9ef">new</span> UTF8Encoding();
            jsonStr = client.DownloadString(url);
        }
        <span style="color:#75715e">#endregion
</span><span style="color:#75715e"></span>    }
}
</code></pre></div><p><strong>如果有bug可以随时提出来 .^_^</strong></p>
<p><strong>需要 .Net 4 或 以上的环境</strong></p>
<h2 id="下载">下载</h2>
<ul>
<li>程序 : <a href="http://pan.baidu.com/s/1kTMm6oB">http://pan.baidu.com/s/1kTMm6oB</a> 密码：zdqx</li>
<li>源码 : <a href="https://github.com/eightpigs/DouBanFM">https://github.com/eightpigs/DouBanFM</a></li>
</ul>

  
    <br />
    <br />
    <hr />
    文章作者：eightpigs
    <br />
    创作时间：2014-11-10
    <br />
    更新时间：
    
      2019-03-04
    
    <br />
    许可协议：<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" class="cc">CC by-nc-nd 4.0</a>
    <hr />
  
</div>

<script charset="utf-8">
  encode("tag")
  encode("category")
  function encode(ele) {
    var elems = document.getElementsByClassName(ele)
    if (elems) {
      for (var i=0; i < elems.length; i++) {
        var id = elems[i].getAttribute("data-real")
        var href = elems[i].getAttribute("href")
        if (href && id) {
          id = id.toLowerCase()
          if (href.indexOf(id) != -1) {
            elems[i].setAttribute("href",  href.replace(id, encodeURIComponent(id)));
          }
        }
      }
    }
  }
</script>



<div class="footer">
  
  <div class="copyright">&copy; 2014 - 
    
      2020

    
      Eightpigs 
  </div>
  
  <div class="navbar">
  <ul>
  
    <li>
      <a href="/">首页</a>
    </li>
  
    <li>
      <a href="/archives">归档</a>
    </li>
  
    <li>
      <a href="/pages/about">关于</a>
    </li>
  
  </ul>
</div>

</div>


<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
 


  


  


  


